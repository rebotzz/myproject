# myproject
项目练习代码

## http server 
- 1.tcp通讯,linux网络接口的使用
- 2.http协议,读取并解析报头,构建响应,发送数据
- 3.线程池技术,生产者消费者模型,互斥锁和条件变量
- 4.单例设计, CGI编写使用:网络计算器,mysql数据库访问(注册),todo: 日期计算器,搜索引擎(代理)
- 5.实现http/1.1长链接功能:单独一个线程管理连接
- todo: IO多路复用(reactor模型), 音乐播放功能, 留言板功能, http/1.1长链接功能, 视频播放功能? 网络.js小游戏功能? url中特殊字符需要(decode/encode) https



### 遇到的问题
- 1.http/1.1长链接功能
```
最开始打算使用alarm计时,但是alarm触发时发送SIGALRM信号,信号针对的是整个进程,不能区分是哪一个线程. 否定
查阅后发现有timer_create()系列接口可以针对线程计时,但是尝试后发现接口参数类型不便于使用(传递要管理的sockfd). 否定
最终方案: 单独一个线程管理连接,借助任务列表,轮询检查timeout
```
- 2.留言板功能制作
```
前端代码的阅读...
待解决: 实现数据传递 
```
### bug
- 1.bug: cgi post方法通过管道通讯存在问题 
```
-> 猜测:管道同步互斥?SIGPIPE信号?多线程干扰? -> 初步否定
可能是因为管道同步互斥的缘故,子进程开始执行过多业务逻辑,进程卡住
初步解决:
破案了,接口功能重复, 我在cgi通用接口中读取body一次, 然后子进程又读取一次, 唉...
```
- 2.bug: 对方退出连接: 关闭子进程 ->没有关闭,卡死了
- 3.bug: 线程数量不能动态调整, 如果线程数量过少,发送消息不足, 网页现实错误
- 4.bug: sockfd是临界资源,应该只由一个线程访问,否则就得加锁,   
- 5.bug: 严重->长链接:消息乱序问题!!!!      
猜测: 连续报头解析错误导致 --> 连接断开  测试结果: 连续报头解析正确;
猜测: 浏览器为了性能使用多线程获取资源, 导致多个tcp socket
一个hash表, 使得一个ip port 只能有一个task  --> 不行:浏览器可能多个线程获取资源, 多个socket
暂时无法解决: 退回http/1.0短链接
猜测:
还可能是浏览器使用了更高级的http协议2/3
线程池动态增加，依据任务队列的数量，如果超过一定百分比，增加线程数量，并管理起来
是不是直接sendfile 没有让响应报头和文本关联起来  -- 不,代码是关联的,但是结果需要验证
有点像http2 服务器可以把资源提前发送

### 小知识
- 1.mysql
```
systemctl start mysql.service  // mysql8.0 服务端启动不是mysqld, 是mysql.service
/etc/mysql/mysql.conf.d/mysqld.cnf  // mysql8.0修改配置
password("密码") 被删除了 替代: md5() --> 32字节; SHA1() --> 40字节
flush privileges
```
- 2.文件
```
open打开文件, 如果新建文件, 8进制权限表示需要0666, 不能直接666, 0表示八进制
```
- 3.cpp-http开源库的使用